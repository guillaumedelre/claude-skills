# Symfony 7.4 Asset - Complete Reference

## Table of Contents

- [Installation](#installation)
- [Overview](#overview)
- [Version Strategies](#version-strategies)
- [Package Types](#package-types)
- [Named Packages](#named-packages)
- [Request Context](#request-context)
- [Custom Version Strategies](#custom-version-strategies)
- [Other Protocols](#other-protocols)

---

## Installation

```bash
composer require symfony/asset
```

## Overview

The Asset component manages URL generation and versioning of web assets (CSS, JavaScript, images). It provides:

- **Packages** to group assets under common paths and avoid repetition
- **Version strategies** for cache busting
- **CDN support** with multiple base URLs
- **Request context awareness** for proper base path handling

All packages implement `PackageInterface`:

```php
getVersion(string $path): string   // Returns asset version
getUrl(string $path): string       // Returns absolute or root-relative URL
```

---

## Version Strategies

### EmptyVersionStrategy

No versioning applied. URLs are returned as-is.

```php
use Symfony\Component\Asset\Package;
use Symfony\Component\Asset\VersionStrategy\EmptyVersionStrategy;

$package = new Package(new EmptyVersionStrategy());

echo $package->getUrl('/image.png');  // /image.png
echo $package->getUrl('image.png');   // image.png
```

### StaticVersionStrategy

Appends a static version string to all asset URLs.

```php
use Symfony\Component\Asset\Package;
use Symfony\Component\Asset\VersionStrategy\StaticVersionStrategy;

$package = new Package(new StaticVersionStrategy('v1'));

echo $package->getUrl('/image.png');  // /image.png?v1
echo $package->getUrl('image.png');   // image.png?v1
```

**Custom format strings** (sprintf-compatible, `%1$s` = path, `%2$s` = version):

```php
// Query parameter style
$package = new Package(new StaticVersionStrategy('v1', '%s?version=%s'));
echo $package->getUrl('/image.png');  // /image.png?version=v1

// Version as path prefix
$package = new Package(new StaticVersionStrategy('v1', '%2$s/%1$s'));
echo $package->getUrl('/image.png');  // /v1/image.png
echo $package->getUrl('image.png');   // v1/image.png
```

### JsonManifestVersionStrategy

Maps source file paths to versioned output files using a JSON manifest (generated by Webpack, Vite, etc.).

**Example manifest (`rev-manifest.json`):**

```json
{
    "css/app.css": "build/css/app.b916426ea1d10021f3f17ce8031f93c2.css",
    "js/app.js": "build/js/app.13630905267b809161e71d0f8a0c017b.js"
}
```

**Usage:**

```php
use Symfony\Component\Asset\Package;
use Symfony\Component\Asset\VersionStrategy\JsonManifestVersionStrategy;

$package = new Package(new JsonManifestVersionStrategy(__DIR__.'/rev-manifest.json'));

echo $package->getUrl('css/app.css');
// build/css/app.b916426ea1d10021f3f17ce8031f93c2.css
```

**Strict mode** -- throws an exception when an asset is not found in the manifest:

```php
$package = new Package(
    new JsonManifestVersionStrategy(
        __DIR__.'/rev-manifest.json',
        null,
        true  // strict mode
    )
);

echo $package->getUrl('not-found.css');  // throws AssetNotFoundException
```

**Remote manifest** (loaded via HTTP client):

```php
use Symfony\Component\HttpClient\HttpClient;

$httpClient = HttpClient::create();
$package = new Package(
    new JsonManifestVersionStrategy('https://cdn.example.com/rev-manifest.json', $httpClient)
);
```

---

## Package Types

### Package (Basic)

The simplest package. Returns URLs with versioning applied, no base path.

```php
use Symfony\Component\Asset\Package;
use Symfony\Component\Asset\VersionStrategy\StaticVersionStrategy;

$package = new Package(new StaticVersionStrategy('v1'));

echo $package->getUrl('/main.css');  // /main.css?v1
```

### PathPackage

Groups assets under a common base path. Relative paths get the base path prepended; absolute paths (starting with `/`) are returned as-is.

```php
use Symfony\Component\Asset\PathPackage;
use Symfony\Component\Asset\VersionStrategy\StaticVersionStrategy;

$package = new PathPackage('/static/images', new StaticVersionStrategy('v1'));

echo $package->getUrl('logo.png');   // /static/images/logo.png?v1
echo $package->getUrl('/logo.png');  // /logo.png?v1 (absolute path ignores base)
```

### UrlPackage

Generates absolute URLs, ideal for CDN-hosted assets.

```php
use Symfony\Component\Asset\UrlPackage;
use Symfony\Component\Asset\VersionStrategy\StaticVersionStrategy;

$package = new UrlPackage(
    'https://static.example.com/images/',
    new StaticVersionStrategy('v1')
);

echo $package->getUrl('/logo.png');  // https://static.example.com/images/logo.png?v1
```

**Schema-agnostic URLs** (auto-adapts to HTTP/HTTPS):

```php
$package = new UrlPackage(
    '//static.example.com/images/',
    new StaticVersionStrategy('v1')
);

echo $package->getUrl('/logo.png');  // //static.example.com/images/logo.png?v1
```

**Multiple CDNs** (load-balanced, deterministic per asset for caching):

```php
$urls = [
    'https://static1.example.com/images/',
    'https://static2.example.com/images/',
];
$package = new UrlPackage($urls, new StaticVersionStrategy('v1'));

echo $package->getUrl('/logo.png');  // https://static1.example.com/images/logo.png?v1
echo $package->getUrl('/icon.png');  // https://static2.example.com/images/icon.png?v1
```

The same asset always resolves to the same CDN domain, ensuring browser and proxy caches remain effective.

---

## Named Packages

The `Packages` class manages a default package and multiple named packages:

```php
use Symfony\Component\Asset\Package;
use Symfony\Component\Asset\Packages;
use Symfony\Component\Asset\PathPackage;
use Symfony\Component\Asset\UrlPackage;
use Symfony\Component\Asset\VersionStrategy\StaticVersionStrategy;

$versionStrategy = new StaticVersionStrategy('v1');

$packages = new Packages(
    new Package($versionStrategy),  // default
    [
        'img' => new UrlPackage('https://img.example.com/', $versionStrategy),
        'doc' => new PathPackage('/somewhere/deep/for/documents', $versionStrategy),
    ]
);

// Default package
echo $packages->getUrl('/main.css');                // /main.css?v1

// Named packages
echo $packages->getUrl('/logo.png', 'img');         // https://img.example.com/logo.png?v1
echo $packages->getUrl('resume.pdf', 'doc');        // /somewhere/deep/for/documents/resume.pdf?v1
```

---

## Request Context

Both `PathPackage` and `UrlPackage` accept a context object to adapt URLs based on the current HTTP request.

### PathPackage with RequestStackContext

Prepends the application base URL (useful when app is not at document root):

```php
use Symfony\Component\Asset\Context\RequestStackContext;
use Symfony\Component\Asset\PathPackage;
use Symfony\Component\Asset\VersionStrategy\StaticVersionStrategy;

$package = new PathPackage(
    '/static/images',
    new StaticVersionStrategy('v1'),
    new RequestStackContext($requestStack)
);

// If request base is /myapp:
echo $package->getUrl('logo.png');   // /myapp/static/images/logo.png?v1
echo $package->getUrl('/logo.png');  // /logo.png?v1
```

### UrlPackage with RequestStackContext

Filters URLs by request scheme (HTTP vs HTTPS):

```php
use Symfony\Component\Asset\Context\RequestStackContext;
use Symfony\Component\Asset\UrlPackage;
use Symfony\Component\Asset\VersionStrategy\StaticVersionStrategy;

$package = new UrlPackage(
    ['http://example.com/', 'https://example.com/'],
    new StaticVersionStrategy('v1'),
    new RequestStackContext($requestStack)
);

// On HTTPS request:
echo $package->getUrl('/logo.png');  // https://example.com/logo.png?v1
```

---

## Custom Version Strategies

Implement `VersionStrategyInterface`:

```php
use Symfony\Component\Asset\VersionStrategy\VersionStrategyInterface;

class DateVersionStrategy implements VersionStrategyInterface
{
    private string $version;

    public function __construct()
    {
        $this->version = date('Ymd');
    }

    public function getVersion(string $path): string
    {
        return $this->version;
    }

    public function applyVersion(string $path): string
    {
        return sprintf('%s?v=%s', $path, $this->getVersion($path));
    }
}
```

Usage:

```php
$package = new Package(new DateVersionStrategy());
echo $package->getUrl('/style.css');  // /style.css?v=20260202
```

---

## Other Protocols

`UrlPackage` supports `file://`, `ftp://`, and other protocols:

```php
use Symfony\Component\Asset\UrlPackage;
use Symfony\Component\Asset\VersionStrategy\EmptyVersionStrategy;

$localPackage = new UrlPackage('file:///path/to/images/', new EmptyVersionStrategy());
echo $localPackage->getUrl('/logo.png');  // file:///path/to/images/logo.png

$ftpPackage = new UrlPackage('ftp://example.com/images/', new EmptyVersionStrategy());
echo $ftpPackage->getUrl('/logo.png');    // ftp://example.com/images/logo.png
```
